import jpype
import asposecells  # pip install aspose-cells

# -------- Start the JVM --------
jpype.startJVM(classpath=[asposecells.__jar__])     # JPype ≥ 1.4
from jpype import JImplements, JOverride           # decorators are faster than JProxy

from com.aspose.cells import LoadOptions, Workbook, MemorySetting

# -------- Implement the Java interface --------
@JImplements("com.aspose.cells.LightCellsDataHandler")
class MyHandler(object):

    # ---------- sheet ----------
    @JOverride
    def startSheet(self, sheet):
        return sheet.getName() == "Data"       # keep only the sheet we need

    # ---------- row (2 callbacks) ----------
    @JOverride
    def startRow(self, rowIndex):
        self.rowIdx = rowIndex                 # remember index for later
        return True                            # read row props → will call processRow

    @JOverride
    def processRow(self, row):                 # 'row' is com.aspose.cells.Row
        if row.isHidden():                     # skip hidden rows, for example
            return False                       # → skip every cell in this row
        return True                            # → walk through cells

    # ---------- cell (2 callbacks) ----------
    @JOverride
    def startCell(self, colIndex):
        return True                            # keep every cell (quick filter point)

    @JOverride
    def processCell(self, cell):               # 'cell' is com.aspose.cells.Cell
        print(self.rowIdx, cell.getColumn(), cell.getValue())
        return True

    # ---------- required no-op ends ----------
    def endRow(self):   return True
    def endSheet(self): return True

handler = MyHandler()          # JPype turns it into a Java proxy on instantiation

# -------- Configure streaming load --------
opts = LoadOptions()
opts.setLightCellsDataHandler(handler)
opts.setMemorySetting(MemorySetting.MEMORY_PREFERENCE)   # keep rows on disk
opts.setParseFormulaOnOpen(False)                        # skip formula parsing

# -------- Trigger parsing (streaming happens here) --------
Workbook("really_big.xlsx", opts)
jpype.shutdownJVM()
